<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Binary Formats &mdash; pgpointcloud</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="Download" href="../download.html" />
    <link rel="prev" title="Compressions" href="compressions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> pgPointcloud
          </a>
              <div class="version">
                1.2.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Concepts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="schemas.html">Schemas</a></li>
<li class="toctree-l2"><a class="reference internal" href="objects.html">Point Cloud Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="tables.html">Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="compressions.html">Compressions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Binary Formats</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#point-binary">Point Binary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#patch-binary">Patch Binary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#uncompressed">Uncompressed</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dimensional">Dimensional</a></li>
<li class="toctree-l4"><a class="reference internal" href="#laz">LAZ</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../functions/index.html">Functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../update.html">Update</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pgPointcloud</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Concepts</a> &raquo;</li>
      <li>Binary Formats</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="binary-formats">
<span id="id1"></span><h1>Binary Formats<a class="headerlink" href="#binary-formats" title="Permalink to this heading"></a></h1>
<p>In order to preserve some compactness in dump files and network transmissions,
the binary formats need to retain their native compression. All binary formats
are hex-encoded before output.</p>
<p>The point and patch binary formats start with a common header, which provides:</p>
<ul class="simple">
<li><p>endianness flag, to allow portability between architectures</p></li>
<li><p>pcid number, to look up the schema information in the <code class="docutils literal notranslate"><span class="pre">pointcloud_formats</span></code> table</p></li>
</ul>
<p>The patch binary formats have additional standard header information:</p>
<ul class="simple">
<li><p>the compression number, which indicates how to interpret the data</p></li>
<li><p>the number of points in the patch</p></li>
</ul>
<section id="point-binary">
<h2>Point Binary<a class="headerlink" href="#point-binary" title="Permalink to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">byte</span><span class="p">:</span>     <span class="n">endianness</span> <span class="p">(</span><span class="mi">1</span> <span class="o">=</span> <span class="n">NDR</span><span class="p">,</span> <span class="mi">0</span> <span class="o">=</span> <span class="n">XDR</span><span class="p">)</span>
<span class="n">uint32</span><span class="p">:</span>   <span class="n">pcid</span> <span class="p">(</span><span class="n">key</span> <span class="n">to</span> <span class="n">POINTCLOUD_SCHEMAS</span><span class="p">)</span>
<span class="n">uchar</span><span class="p">[]:</span>  <span class="n">pointdata</span> <span class="p">(</span><span class="n">interpret</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">pcid</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="patch-binary">
<h2>Patch Binary<a class="headerlink" href="#patch-binary" title="Permalink to this heading"></a></h2>
<section id="uncompressed">
<h3>Uncompressed<a class="headerlink" href="#uncompressed" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">byte</span><span class="p">:</span>         <span class="n">endianness</span> <span class="p">(</span><span class="mi">1</span> <span class="o">=</span> <span class="n">NDR</span><span class="p">,</span> <span class="mi">0</span> <span class="o">=</span> <span class="n">XDR</span><span class="p">)</span>
<span class="n">uint32</span><span class="p">:</span>       <span class="n">pcid</span> <span class="p">(</span><span class="n">key</span> <span class="n">to</span> <span class="n">POINTCLOUD_SCHEMAS</span><span class="p">)</span>
<span class="n">uint32</span><span class="p">:</span>       <span class="mi">0</span> <span class="o">=</span> <span class="n">no</span> <span class="n">compression</span>
<span class="n">uint32</span><span class="p">:</span>       <span class="n">npoints</span>
<span class="n">pointdata</span><span class="p">[]:</span>  <span class="n">interpret</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">pcid</span>
</pre></div>
</div>
</section>
<section id="dimensional">
<h3>Dimensional<a class="headerlink" href="#dimensional" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">byte</span><span class="p">:</span>          <span class="n">endianness</span> <span class="p">(</span><span class="mi">1</span> <span class="o">=</span> <span class="n">NDR</span><span class="p">,</span> <span class="mi">0</span> <span class="o">=</span> <span class="n">XDR</span><span class="p">)</span>
<span class="n">uint32</span><span class="p">:</span>        <span class="n">pcid</span> <span class="p">(</span><span class="n">key</span> <span class="n">to</span> <span class="n">POINTCLOUD_SCHEMAS</span><span class="p">)</span>
<span class="n">uint32</span><span class="p">:</span>        <span class="mi">2</span> <span class="o">=</span> <span class="n">dimensional</span> <span class="n">compression</span>
<span class="n">uint32</span><span class="p">:</span>        <span class="n">npoints</span>
<span class="n">dimensions</span><span class="p">[]:</span>  <span class="n">dimensionally</span> <span class="n">compressed</span> <span class="n">data</span> <span class="k">for</span> <span class="n">each</span> <span class="n">dimension</span>
</pre></div>
</div>
<p>Each compressed dimension starts with a byte, that gives the compression type,
and then a uint32 that gives the size of the segment in bytes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">byte</span><span class="p">:</span>           <span class="n">dimensional</span> <span class="n">compression</span> <span class="nb">type</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">uint32</span><span class="p">:</span>         <span class="n">size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">compressed</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">bytes</span>
<span class="n">data</span><span class="p">[]:</span>         <span class="n">the</span> <span class="n">compressed</span> <span class="n">dimensional</span> <span class="n">values</span>
</pre></div>
</div>
<p>There are four possible compression types used in dimensional compression:</p>
<ul class="simple">
<li><p>no compression = 0,</p></li>
<li><p>run-length compression = 1,</p></li>
<li><p>significant bits removal = 2,</p></li>
<li><p>deflate = 3</p></li>
</ul>
<p><strong>No dimension compress</strong></p>
<p>For dimensional compression 0 (no compression) the values just appear in order.
The length of words in this dimension must be determined from the schema
document.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">word</span><span class="p">[]:</span>
</pre></div>
</div>
<p><strong>Run-length compress dimension</strong></p>
<p>For run-length compression, the data stream consists of a set of pairs: a byte
value indicating the length of the run, and a data value indicating the value
that is repeated.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">byte</span><span class="p">:</span>          <span class="n">number</span> <span class="n">of</span> <span class="n">times</span> <span class="n">the</span> <span class="n">word</span> <span class="n">repeats</span>
<span class="n">word</span><span class="p">:</span>          <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">word</span> <span class="n">being</span> <span class="n">repeated</span>
<span class="o">....</span>           <span class="n">repeated</span> <span class="k">for</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">runs</span>
</pre></div>
</div>
<p>The length of words in this dimension must be determined from the schema document.</p>
<p><strong>Significant bits removal on dimension</strong></p>
<p>Significant bits removal starts with two words. The first word just gives the
number of bits that are “significant”, that is the number of bits left after
the common bits are removed from any given word. The second word is a bitmask
of the common bits, with the final, variable bits zeroed out.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">word1</span><span class="p">:</span>          <span class="n">number</span> <span class="n">of</span> <span class="n">variable</span> <span class="n">bits</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">dimension</span>
<span class="n">word2</span><span class="p">:</span>          <span class="n">the</span> <span class="n">bits</span> <span class="n">that</span> <span class="n">are</span> <span class="n">shared</span> <span class="n">by</span> <span class="n">every</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">dimension</span>
<span class="n">data</span><span class="p">[]:</span>         <span class="n">variable</span> <span class="n">bits</span> <span class="n">packed</span> <span class="n">into</span> <span class="n">a</span> <span class="n">data</span> <span class="n">buffer</span>
</pre></div>
</div>
<p><strong>Deflate dimension</strong></p>
<p>Where simple compression schemes fail, general purpose compression is applied
to the dimension using zlib. The data area is a raw zlib buffer suitable for
passing directly to the inflate() function. The size of the input buffer is
given in the common dimension header. The size of the output buffer can be
derived from the patch metadata by multiplying the dimension word size by the
number of points in the patch.</p>
</section>
<section id="laz">
<h3>LAZ<a class="headerlink" href="#laz" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">byte</span><span class="p">:</span>          <span class="n">endianness</span> <span class="p">(</span><span class="mi">1</span> <span class="o">=</span> <span class="n">NDR</span><span class="p">,</span> <span class="mi">0</span> <span class="o">=</span> <span class="n">XDR</span><span class="p">)</span>
<span class="n">uint32</span><span class="p">:</span>        <span class="n">pcid</span> <span class="p">(</span><span class="n">key</span> <span class="n">to</span> <span class="n">POINTCLOUD_SCHEMAS</span><span class="p">)</span>
<span class="n">uint32</span><span class="p">:</span>        <span class="mi">2</span> <span class="o">=</span> <span class="n">LAZ</span> <span class="n">compression</span>
<span class="n">uint32</span><span class="p">:</span>        <span class="n">npoints</span>
<span class="n">uint32</span><span class="p">:</span>        <span class="n">LAZ</span> <span class="n">data</span> <span class="n">size</span>
<span class="n">data</span><span class="p">[]:</span>        <span class="n">LAZ</span> <span class="n">data</span>
</pre></div>
</div>
<p>Use <a class="reference external" href="https://github.com/hobu/laz-perf">laz-perf</a> library to read the LAZ data buffer out into a LAZ buffer.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="compressions.html" class="btn btn-neutral float-left" title="Compressions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../download.html" class="btn btn-neutral float-right" title="Download" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  
    <div class="footer">
        <div class="container">
            &copy;  2022
            <a href="https://github.com/pramsey">Paul Ramsey</a>,
            <a href="http://github.com/pblottiere">Paul Blottiere</a>,
            <a href="http://github.com/mbredif">Mathieu Brédif</a>,
            <a href="http://github.com/elemoine">Eric Lemoine</a>,
            and
            <a href="https://github.com/pgpointcloud/pointcloud/graphs/contributors">others</a>,
        </div>
    </div>
     


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>